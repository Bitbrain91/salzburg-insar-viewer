services:
  db:
    image: postgis/postgis:15-3.4
    environment:
      POSTGRES_DB: insar
      POSTGRES_USER: insar
      POSTGRES_PASSWORD: insar
    ports:
      - "5432:5432"
    volumes:
      - insar_db:/var/lib/postgresql/data

  mlflow:
    image: python:3.12-slim
    working_dir: /app
    ports:
      - "5001:5001"
    volumes:
      - ./mlruns:/mlruns
    command: >
      sh -c "pip install --no-cache-dir mlflow[mcp]==3.8.1 &&
             mlflow server --host 0.0.0.0 --port 5001 \
               --backend-store-uri sqlite:////mlruns/mlflow.db \
               --default-artifact-root /mlruns"

volumes:
  insar_db:
